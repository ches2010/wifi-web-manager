<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>无线网络管理器 - HiNAS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .card { margin-bottom: 20px; }
        .btn { margin: 5px; }
        .hidden { display: none; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body class="bg-light">
    <div class="container py-4">
        <h1 class="mb-4">📶 无线网络管理器</h1>

        <div class="card">
            <div class="card-header">当前状态</div>
            <div class="card-body">
                <div id="status">加载中...</div>
                <button class="btn btn-outline-primary" onclick="refreshStatus()">🔄 刷新状态</button>
                <button class="btn btn-outline-success" onclick="toggleWifi('on')">✅ 开启无线</button>
                <button class="btn btn-outline-danger" onclick="toggleWifi('off')">⛔ 关闭无线</button>
            </div>
        </div>

        <div class="card">
            <div class="card-header">扫描附近网络</div>
            <div class="card-body">
                <button class="btn btn-primary" onclick="scanWifi()">🔍 扫描 Wi-Fi</button>
                <div id="scanResults" class="mt-3"></div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">连接 Wi-Fi</div>
            <div class="card-body">
                <input type="text" id="connectSsid" class="form-control mb-2" placeholder="输入 SSID">
                <input type="password" id="connectPassword" class="form-control mb-2" placeholder="密码（如无密码可留空）">
                <button class="btn btn-success" onclick="connectWifi()">🔌 连接</button>
                <div id="connectResult" class="mt-2"></div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">创建热点</div>
            <div class="card-body">
                <input type="text" id="hotspotSsid" class="form-control mb-2" placeholder="热点名称" value="HiNAS-Hotspot">
                <input type="password" id="hotspotPassword" class="form-control mb-2" placeholder="热点密码（至少8位）" value="12345678">
                <button class="btn btn-warning" onclick="startHotspot()">📡 启动热点</button>
                <button class="btn btn-secondary" onclick="stopHotspot()">🛑 停止热点</button>
                <div id="hotspotResult" class="mt-2"></div>
            </div>
        </div>

    </div>

    <script>
        async function apiCall(url, data = null) {
            const options = {
                method: data ? 'POST' : 'GET',
                headers: { 'Content-Type': 'application/json' }
            };
            if (data) options.body = JSON.stringify(data);
            const res = await fetch(url, options);
            return await res.json();
        }

        async function refreshStatus() {
            const data = await apiCall('/status');
            if (data.error) {
                document.getElementById('status').innerHTML = `<div class="alert alert-danger">${data.error}</div>`;
            } else {
                document.getElementById('status').innerHTML = `
                    <p><strong>网卡：</strong> ${data.interface}</p>
                    <p><strong>状态：</strong> ${data.state}</p>
                    <p><strong>当前连接：</strong> ${data.current_ssid}</p>
                `;
            }
        }

        async function toggleWifi(action) {
            const data = await apiCall('/toggle', { action });
            alert(data.error || data.message);
            refreshStatus();
        }

        async function scanWifi() {
            const data = await apiCall('/scan');
            if (data.error) {
                document.getElementById('scanResults').innerHTML = `<div class="alert alert-danger">${data.error}</div>`;
                return;
            }
            let html = '<div class="list-group">';
            data.forEach(net => {
                html += `
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <strong>${net.ssid}</strong><br>
                            <small>信号: ${net.signal}% | 安全: ${net.security}</small>
                        </div>
                        <button class="btn btn-sm btn-outline-primary" onclick="quickConnect('${net.ssid}')">连接</button>
                    </div>
                `;
            });
            html += '</div>';
            document.getElementById('scanResults').innerHTML = html;
        }

        function quickConnect(ssid) {
            document.getElementById('connectSsid').value = ssid;
        }

        async function connectWifi() {
            const ssid = document.getElementById('connectSsid').value;
            const password = document.getElementById('connectPassword').value;
            if (!ssid) {
                alert('请输入 SSID');
                return;
            }
            const data = await apiCall('/connect', { ssid, password });
            document.getElementById('connectResult').innerHTML = `
                <div class="alert alert-${data.error ? 'danger' : 'success'}">
                    ${data.error || data.message}
                </div>
            `;
            refreshStatus();
        }

        async function startHotspot() {
            const ssid = document.getElementById('hotspotSsid').value;
            const password = document.getElementById('hotspotPassword').value;
            if (!ssid) {
                alert('请输入热点名称');
                return;
            }
            const data = await apiCall('/hotspot', { action: 'start', ssid, password });
            document.getElementById('hotspotResult').innerHTML = `
                <div class="alert alert-${data.error ? 'danger' : 'success'}">
                    ${data.error || data.message}
                </div>
            `;
            refreshStatus();
        }

        async function stopHotspot() {
            const data = await apiCall('/hotspot', { action: 'stop' });
            document.getElementById('hotspotResult').innerHTML = `
                <div class="alert alert-${data.error ? 'danger' : 'success'}">
                    ${data.error || data.message}
                </div>
            `;
            refreshStatus();
        }

        // 页面加载时自动刷新状态
        document.addEventListener('DOMContentLoaded', refreshStatus);
    </script>
</body>
</html>
