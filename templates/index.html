<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ— çº¿ç½‘ç»œç®¡ç†å™¨ - HiNAS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .card { margin-bottom: 20px; }
        .btn { margin: 5px; }
        .hidden { display: none; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body class="bg-light">
    <div class="container py-4">
        <h1 class="mb-4">ğŸ“¶ æ— çº¿ç½‘ç»œç®¡ç†å™¨</h1>

        <div class="card">
            <div class="card-header">å½“å‰çŠ¶æ€</div>
            <div class="card-body">
                <div id="status">åŠ è½½ä¸­...</div>
                <button class="btn btn-outline-primary" onclick="refreshStatus()">ğŸ”„ åˆ·æ–°çŠ¶æ€</button>
                <button class="btn btn-outline-success" onclick="toggleWifi('on')">âœ… å¼€å¯æ— çº¿</button>
                <button class="btn btn-outline-danger" onclick="toggleWifi('off')">â›” å…³é—­æ— çº¿</button>
            </div>
        </div>

        <div class="card">
            <div class="card-header">æ‰«æé™„è¿‘ç½‘ç»œ</div>
            <div class="card-body">
                <button class="btn btn-primary" onclick="scanWifi()">ğŸ” æ‰«æ Wi-Fi</button>
                <div id="scanResults" class="mt-3"></div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">è¿æ¥ Wi-Fi</div>
            <div class="card-body">
                <input type="text" id="connectSsid" class="form-control mb-2" placeholder="è¾“å…¥ SSID">
                <input type="password" id="connectPassword" class="form-control mb-2" placeholder="å¯†ç ï¼ˆå¦‚æ— å¯†ç å¯ç•™ç©ºï¼‰">
                <button class="btn btn-success" onclick="connectWifi()">ğŸ”Œ è¿æ¥</button>
                <div id="connectResult" class="mt-2"></div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">åˆ›å»ºçƒ­ç‚¹</div>
            <div class="card-body">
                <input type="text" id="hotspotSsid" class="form-control mb-2" placeholder="çƒ­ç‚¹åç§°" value="HiNAS-Hotspot">
                <input type="password" id="hotspotPassword" class="form-control mb-2" placeholder="çƒ­ç‚¹å¯†ç ï¼ˆè‡³å°‘8ä½ï¼‰" value="12345678">
                <button class="btn btn-warning" onclick="startHotspot()">ğŸ“¡ å¯åŠ¨çƒ­ç‚¹</button>
                <button class="btn btn-secondary" onclick="stopHotspot()">ğŸ›‘ åœæ­¢çƒ­ç‚¹</button>
                <div id="hotspotResult" class="mt-2"></div>
            </div>
        </div>

    </div>

    <script>
        async function apiCall(url, data = null) {
            const options = {
                method: data ? 'POST' : 'GET',
                headers: { 'Content-Type': 'application/json' }
            };
            if (data) options.body = JSON.stringify(data);
            const res = await fetch(url, options);
            return await res.json();
        }

        async function refreshStatus() {
            const data = await apiCall('/status');
            if (data.error) {
                document.getElementById('status').innerHTML = `<div class="alert alert-danger">${data.error}</div>`;
            } else {
                document.getElementById('status').innerHTML = `
                    <p><strong>ç½‘å¡ï¼š</strong> ${data.interface}</p>
                    <p><strong>çŠ¶æ€ï¼š</strong> ${data.state}</p>
                    <p><strong>å½“å‰è¿æ¥ï¼š</strong> ${data.current_ssid}</p>
                `;
            }
        }

        async function toggleWifi(action) {
            const data = await apiCall('/toggle', { action });
            alert(data.error || data.message);
            refreshStatus();
        }

        async function scanWifi() {
            const data = await apiCall('/scan');
            if (data.error) {
                document.getElementById('scanResults').innerHTML = `<div class="alert alert-danger">${data.error}</div>`;
                return;
            }
            let html = '<div class="list-group">';
            data.forEach(net => {
                html += `
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <strong>${net.ssid}</strong><br>
                            <small>ä¿¡å·: ${net.signal}% | å®‰å…¨: ${net.security}</small>
                        </div>
                        <button class="btn btn-sm btn-outline-primary" onclick="quickConnect('${net.ssid}')">è¿æ¥</button>
                    </div>
                `;
            });
            html += '</div>';
            document.getElementById('scanResults').innerHTML = html;
        }

        function quickConnect(ssid) {
            document.getElementById('connectSsid').value = ssid;
        }

        async function connectWifi() {
            const ssid = document.getElementById('connectSsid').value;
            const password = document.getElementById('connectPassword').value;
            if (!ssid) {
                alert('è¯·è¾“å…¥ SSID');
                return;
            }
            const data = await apiCall('/connect', { ssid, password });
            document.getElementById('connectResult').innerHTML = `
                <div class="alert alert-${data.error ? 'danger' : 'success'}">
                    ${data.error || data.message}
                </div>
            `;
            refreshStatus();
        }

        async function startHotspot() {
            const ssid = document.getElementById('hotspotSsid').value;
            const password = document.getElementById('hotspotPassword').value;
            if (!ssid) {
                alert('è¯·è¾“å…¥çƒ­ç‚¹åç§°');
                return;
            }
            const data = await apiCall('/hotspot', { action: 'start', ssid, password });
            document.getElementById('hotspotResult').innerHTML = `
                <div class="alert alert-${data.error ? 'danger' : 'success'}">
                    ${data.error || data.message}
                </div>
            `;
            refreshStatus();
        }

        async function stopHotspot() {
            const data = await apiCall('/hotspot', { action: 'stop' });
            document.getElementById('hotspotResult').innerHTML = `
                <div class="alert alert-${data.error ? 'danger' : 'success'}">
                    ${data.error || data.message}
                </div>
            `;
            refreshStatus();
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åˆ·æ–°çŠ¶æ€
        document.addEventListener('DOMContentLoaded', refreshStatus);
    </script>
</body>
</html>
